---
- name: Restart foreman
  ansible.builtin.command:
    cmd: "systemctl --machine={{ foremanctl_user }}@ --user restart foreman"
  changed_when: true
  # Alternative approach using systemd module (requires become_user):
  # become: true
  # become_user: "{{ foremanctl_user }}"
  # ansible.builtin.systemd:
  #   name: foreman
  #   state: restarted
  #   scope: user

- name: Restart dynflow-sidekiq@
  ansible.builtin.command:
    cmd: "systemctl --machine={{ foremanctl_user }}@ --user restart dynflow-sidekiq@{{ item }}"
  loop:
    - orchestrator
    - worker
    - worker-hosts-queue
  changed_when: true
  # Alternative approach using systemd module (requires become_user):
  # become: true
  # become_user: "{{ foremanctl_user }}"
  # ansible.builtin.systemd:
  #   name: "dynflow-sidekiq@{{ item }}"
  #   state: restarted
  #   scope: user
  # loop:
  #   - orchestrator
  #   - worker
  #   - worker-hosts-queue
