---
- name: Configure Foreman Proxy config secrets as foreman user
  environment:
    XDG_RUNTIME_DIR: "{{ foreman_xdg_runtime_dir }}"
  become: true
  become_user: "{{ foreman_service_user }}"
  block:
    - name: Create settings config secret
      containers.podman.podman_secret:
        state: present
        name: foreman-proxy-settings-yml
        data: "{{ lookup('ansible.builtin.template', 'settings.yml.j2') }}"
      notify:
        - Restart Foreman Proxy

    - name: Create logs config secret
      containers.podman.podman_secret:
        state: present
        name: foreman-proxy-logs-yml
        data: "{{ lookup('ansible.builtin.template', 'settings.d/logs.yml.j2') }}"
      notify:
        - Restart Foreman Proxy
