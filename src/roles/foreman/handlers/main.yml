---
- name: Restart foreman
  environment:
    XDG_RUNTIME_DIR: "{{ foreman_xdg_runtime_dir }}"
  become: true
  become_user: "{{ foreman_service_user }}"
  ansible.builtin.systemd:
    name: foreman
    state: restarted
    scope: user

- name: Restart dynflow-sidekiq@
  environment:
    XDG_RUNTIME_DIR: "{{ foreman_xdg_runtime_dir }}"
  become: true
  become_user: "{{ foreman_service_user }}"
  loop:
    - orchestrator
    - worker
    - worker-hosts-queue
  ansible.builtin.systemd:
    name: "dynflow-sidekiq@{{ item }}"
    state: restarted
    scope: user
